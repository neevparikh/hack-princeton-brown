<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang=""> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8" lang=""> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9" lang=""> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="">
<!--<![endif]-->

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CeaseFire</title>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/flexslider.css">
  <link rel="stylesheet" href="css/jquery.fancybox.css">
  <link rel="stylesheet" href="css/main.css">
  <link rel="stylesheet" href="css/responsive.css">
  <link rel="stylesheet" href="css/animate.min.css">
  <link rel="stylesheet" href="css/font-icon.css">
  <script src="./lib.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
  <script src="https://js.stripe.com/v3/"></script>
</head>

<body>
  <!-- header section -->
  <section class="banner" role="banner">

    <!--header navigation -->
    <header id="header">
      <div class="header-content clearfix"> <a class="logo" href="#"><img src="images/logo.png" alt=""></a>
        <nav class="navigation" role="navigation">
          <li><a href="#intro">Support Us</a></li>
          </ul>
        </nav>
        <a href="#" class="nav-toggle">Menu<span></span></a> </div>
    </header>

    <!-- Main page -->
    <div class="container">
      <div class="col-md-10 col-md-offset-1">
        <div class="banner-text text-center">

          <!-- Search bar -->
          <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU"
            crossorigin="anonymous">

          <!-- Form for the search -->
          <form id="search-form" action="" autocomplete='off'>
            <input id="bar" type="search" placeholder="Enter a zip code" name="query" autofocus>
            <i class="fa fa-search">
              <input id="submit-button" type="submit" value="" placeholder="" />
            </i>
          </form>

          <h1 id="probability" style="right: 100px; top: 100px; position:  absolute;" ></h1>
        </div>
      </div>
     
    </div>
    <div id="map"  style= "position: absolute; width: 1200px; height: 85vh; left: 8%; top: 10em;"></div>
  </section>

  <!-- Include the dependencies for this -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>

  <!-- <script src="../node_modules/datamaps/dist/datamaps.usa.min.js"></script> -->
  <script src="http://datamaps.github.io/scripts/datamaps.usa.min.js"></script>
  <!-- Write the script for the map -->
  <script>

var bubble_map = new Datamap({
        element: document.getElementById("map"),
        scope: 'usa',
        geographyConfig: {
            popupOnHover: false,
            highlightOnHover: false,
            borderColor: '#ffb3b3',
            
        },
        bubblesConfig: {
          borderColor: '#FFFFFF',
          popupOnHover: true, 
          animate: true,
          highlightFillColor: 'red',
        },
        fills: {
            // 'CA': 'blue',
            // 'GA': 'red',
            // 'AK': `rgba(${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`,
            // 'AZ': `rgba(${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`,
            // 'CO': `rgba(${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`,
            // 'CT': `rgba(${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`,
            // 'DE': `rgba(${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`,
            // 'FL': `rgba(${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`,
            // 'HI': `rgba(${Math.floor(Math.random()*256)},${Math.floor(Math.random()*256)}, ${Math.floor(Math.random()*256)})`,



            defaultFill: `rgba(0,0,0,0.5)`
        }, 
        data: {
          
            // 'CA': {fillKey : 'CA'},
            // 'GA': {fillKey : 'GA'},
            // 'AK': {fillKey : 'AK'},
            // 'AZ': {fillKey : 'AZ'},
            // 'CO': {fillKey : 'CO'},
            // 'CT': {fillKey : 'CT'},
            // 'DE': {fillKey : 'DE'},
            // 'FL': {fillKey : 'FL'},
            // 'HI': {fillKey : 'HI'},
        },
    });

    data = [{
        name: 'Atlanta',
        radius: 10,
        latitude: 32.1656,
        longitude: -82.9001
    },
    {
        name: 'Omaha',
        radius: 5,
        latitude: 41.2565,
        longitude: -95.9345
    },
     {
        name: 'Kansas City',
        radius: 10,
        latitude: 39.0997,
        longitude: -94.5786
    },
    {
        name: 'Compton',
        radius: 60,
        latitude: 33.8958,
        longitude: -118.2201
    },
    {
        name: 'Boulder',
        radius: 10,
        latitude: 40.0150,
        longitude: -105.2705
    },
    
    {
        name: 'New York',
        radius: 20,
        latitude: 40.7128,
        longitude: -74.0060
    },
    {
        name: 'Selma',
        radius: 50,
        latitude: 32.4074,
        longitude: -87.0211
    },
    {
        name: 'Seattle',
        radius: 5,
        latitude: 47.6062,
        longitude: -122.3321
    },
    {
        name: 'Oregon',
        radius: 10,
        latitude: 43.8041,
        longitude: -120.5542
    }
    ];
  
    bubble_map.labels({
      labelColor: 'white'
    });
    
    bubble_map.bubbles(data);

     bubble_map.svg.call(d3.behavior.zoom().
        on("zoom", redraw));
    
    function redraw() {
      bubble_map.svg.selectAll("g").attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
 }

  </script>

  <!-- Support Section -->
  <section id="intro" class="section intro no-padding">
    <div class="container-fluid">
      <div class="row no-gutter">
        <div class="flexslider">
          <ul class="slides">
            <li>
              <div class="col-md-6">
                <div class="avatar"> <img src="images/intro-img1.jpg" alt="" class="img-responsive"> </div>
              </div>
              <div class="col-md-6">
                <blockquote>
                  <h1>Support the families</h1>
                  <p>There are at least a thousand cases of mass shootings per year in the US alone. This problem is only
                    growing, and the families are not taking it an easier. Take initiative and support this cause by donating
                    to the families of victims who were just unlucky to be a part of such inhumane acts. </p>
                  <p>We accept donations for the top charities that are doing their best to stop gun violence. </p>
                  <input type="button" class="donate-button" value="Donate" />
                </blockquote>
              </div>
            </li>
            <li>
              <div class="col-md-6">
                <div class="avatar"> <img src="images/intro-img2.jpg" alt="" class="img-responsive"> </div>
              </div>
              <div class="col-md-6">
                <blockquote>
                  <h1>Make the cities better </h1>
                  <p>Donate to the cities we predict to be the most prone to shootings. Again, these payments are completely
                    secure and directly go to legislature/charity organizations that plan to make the world a better place</p>
                  <input type="button" class="donate-button" value="Donate" />
                </blockquote>
              </div>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </section>

  <!-- payment section -->
  <form method="post" id="payment-form">
    <div class="form-row">
      <label for="card-element" style="margin-left: 42%">
        Credit or debit card
      </label>
      <div id="card-element">
        <!-- A Stripe Element will be inserted here. -->
      </div>

      <!-- Used to display form errors. -->
      <div id="card-errors" role="alert"></div>
    </div>

    <button id='pay-button' class='donate-button'>Donate $25</button>
  </form>

  <!-- Necessary scripts -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="js/bootstrap.min.js"></script>
  <script src="js/jquery.flexslider-min.js"></script>
  <script src="js/jquery.fancybox.pack.js"></script>
  <script src="js/retina.min.js"></script>
  <script src="js/modernizr.js"></script>
  <script src="js/main.js"></script>


  <!-- Custom Scripts -->
  <script>
    $(document).ready(function () {

      // Iniitialize the Stripe API with the publically available key
      var stripe = Stripe('pk_test_pPSDPhP3a9L1t545BCGfY5mW');

      // Create an instance of Elements.
      var elements = stripe.elements();

      // Custom styling can be passed to options when creating an Element.
      var style = {
        base: {
          color: '#32325d',
          fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
          fontSmoothing: 'antialiased',
          fontSize: '16px',
          '::placeholder': {
            color: '#aab7c4'
          }
        },
        invalid: {
          color: '#fa755a',
          iconColor: '#fa755a'
        }
      };

      // Create an instance of the card Element.
      var card = elements.create('card', { style: style });

      // Add an instance of the card Element into the `card-element` <div>.
      card.mount('#card-element');

      // Handle real-time validation errors from the card Element.
      card.addEventListener('change', function (event) {
        var displayError = document.getElementById('card-errors');

        if (event.error) {
          displayError.textContent = event.error.message;
        } else {
          displayError.textContent = '';
        }
      });

      // Handle form submission.
      var form = document.getElementById('payment-form');

      form.addEventListener('submit', function (event) {
        event.preventDefault();

        stripe.createToken(card).then(function (result) {
          if (result.error) {

            // Inform the user if there was an error.
            var errorElement = document.getElementById('card-errors');
            errorElement.textContent = result.error.message;
          } else {

            // Send the token to your server.
            stripeTokenHandler(result.token);
          }
        });
      });

      // $('form').submit(false);
      $('#payment-form').fadeOut(0);
      $('#payment-form').addClass('permahover');

      $('.donate-button').on('click', function () {
        if (!$(this).parent().is('#payment-form')) {
          $('#payment-form').fadeToggle(50);
        }
      });

      var submit_search = document.getElementById('submit-button');

      submit_search.addEventListener('click', function (e) {
        e.preventDefault();
        var query = $('#bar').val();
        console.log("QUERY", query);

        split = query.split(" ");
        console.log(split);

        lib.isonlaxman.search['@dev'](split[0], split[1], function (err, results) {
          console.log("HERE", results);
           $('#probability').html(results);
        });
      });

      // On hover on bar
      $('form').one('mouseover', function () {
        $('form').addClass('permahover');
      })

      // Submit the form with the token ID.
      function stripeTokenHandler(token) {
        // Insert the token ID into the form so it gets submitted to the server
        var hiddenInput = document.createElement('input');
        lib.isonlaxman.donate['@dev'](token.id, function () {
          $('#pay-button').html('Thanks');
        });

      }
    });
  </script>

</body>

</html>